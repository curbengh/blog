image: node:alpine # Use latest version of Node.js on Alpine

cache: # add cache to 'node_modules' for speeding up builds
  paths:
    - node_modules/ # Node modules and dependencies

before_script:
  - npm install

test:
  script:
    - npm run snyk # Refer to "scripts" in package.json
    - npm run hexo

  only:
    - master # only trigger when 'master' branch is pushed

# Don't run this job when renovate job runs
  except:
    - schedules
    - web

renovate: # Check dependency update
  script:
    - npm run renovate

  only:
    - schedules # trigger build by schedules
    - web # trigger through "Run pipeline" button in GitLab.com


# # Uncomment below (and comment/remove above) lines for gitlab pages
# image: node:latest # Use latest version of Node.js
# pages:
  # cache: # add cache to 'node_modules' for speeding up builds
    # paths:
      # - node_modules/ # Node modules and dependencies

  # script:
    # - npm install -g snyk hexo-cli
    # - npm install # install node modules
    # - snyk auth $SNYK_TOKEN
    # - snyk protect # Apply patches to node modules
    # - snyk test # Check node modules for vulnerability
    # - hexo deploy # deploy the site.

  # artifacts:
    # paths:
      # - public # deploy to the 'public' folder.

  # only:
    # - master # this job will affect only the 'master' branch
